// Language translations
const translations = {
    he: {
        since: "מאז 1993",
        videoNotSupported: "הדפדפן שלך לא תומך בוידאו HTML.",
        aboutTitle: "מי אנחנו",
        aboutText: "חברת Go business שנוסדה בשנת 1993 מציעה מגוון רחב של שירותים עסקיים. החברה מעניקה לכם את ההזדמנות להשתתף בכל המכירות הפומביות של סחורות מגוונות מהנמל ישירות דרך זום. החברה מאפשרת לכם להירשם ולקנות סחורות מוחרמות ישירות. החברה נותנת הזדמנות למפעלים וחברות להציג את מוצריהם בפני המספר הגדול ביותר של סוחרים וחנויות המחפשים מקורות לרכישת סחורות.",
        packagesTitle: "חבילות מנוי",
        monthly: "חודשי",
        threeMonths: "3 חודשים",
        sixMonths: "6 חודשים",
        yearly: "שנתי",
        auctions: "מכירות פומביות",
        confiscated: "סחורות מוחרמות",
        productDisplay: "הצגת מוצרים",
        banksTitle: "הבנקים הנתמכים",
        contactTitle: "צור קשר",
        send: "שלח",
        allRights: "כל הזכויות שמורות",
        namePlaceholder: "השם",
        businessDomainPlaceholder: "תחום העסק או התחום שבו אתם עוסקים",
        businessDescriptionPlaceholder: "ספרו לנו קצת על העסק שלכם ומה אתם עושים",
        messagePlaceholder: "ההודעה",
        logoAlt: "לוגו Go Business",
        portViewAlt: "תצוגת נמל",
        bankHapoalimAlt: "בנק הפועלים",
        bankMarkantelAlt: "מרכנתיל",
        bankWesternUnionAlt: "Western Union",
        bankSendingAlt: "העברות",
        bankMoneygramAlt: "MoneyGram",
        bankHapoalimName: "בנק הפועלים",
        bankMarkantelName: "מרכנתיל",
        bankWesternUnionName: "Western Union",
        bankSendingName: "העברות",
        bankMoneygramName: "MoneyGram",
        fillAllFields: "אנא מלא את כל השדות",
        messageSentSuccess: "ההודעה נשלחה בהצלחה!"
    },
    ar: {
        since: "منذ 1993",
        videoNotSupported: "متصفحك لا يدعم فيديو HTML.",
        aboutTitle: "من نحن",
        aboutText: "شركه Go business التي تأسست سنه 1993 تقدم الشركه العديد من الخدمات التجاريه تقدم لكم الفرصه بلاشراك في كافه المزادات على بضائع متنوعه من الميناء بشكل مباشر عبر الزوم تقدم لكم امكانيه الاشتراك والشراء من البضائع المصادره بشكل مباشر اعطاء الفرصه للمصانع والشركات بعرض منتجاتهم على اكبر عدد من التجار والمحلات التجاريه التي تبحث عن مصادر لشراء البضائع",
        packagesTitle: "باقات الاشتراك",
        monthly: "شهري",
        threeMonths: "3 شهور",
        sixMonths: "6 شهور",
        yearly: "سنة",
        auctions: "المزادات",
        confiscated: "البضائع المصادره",
        productDisplay: "عرض منتجاتكم",
        banksTitle: "البنوك المدعومة",
        contactTitle: "تواصل معنا",
        send: "إرسال",
        allRights: "جميع الحقوق محفوظة",
        namePlaceholder: "الاسم",
        businessDomainPlaceholder: "مجال مصلحتك أو المجال الذي تعمل فيه",
        businessDescriptionPlaceholder: "أخبرنا قليلاً عن مصلحتك وما تقوم به",
        messagePlaceholder: "الرسالة",
        logoAlt: "شعار Go Business",
        portViewAlt: "منظر الميناء",
        bankHapoalimAlt: "بنك هبوعليم",
        bankMarkantelAlt: "مركنتيل",
        bankWesternUnionAlt: "ويسترن يونيون",
        bankSendingAlt: "التحويلات",
        bankMoneygramAlt: "مونيجرام",
        bankHapoalimName: "بنك هبوعليم",
        bankMarkantelName: "مركنتيل",
        bankWesternUnionName: "ويسترن يونيون",
        bankSendingName: "التحويلات",
        bankMoneygramName: "مونيجرام",
        fillAllFields: "يرجى ملء جميع الحقول",
        messageSentSuccess: "تم إرسال الرسالة بنجاح!"
    },
    en: {
        since: "Since 1993",
        videoNotSupported: "Your browser doesn't support HTML video.",
        aboutTitle: "About Us",
        aboutText: "Go Business company founded in 1993 offers many commercial services. The company gives you the opportunity to participate in all auctions on various goods from the port directly via Zoom. The company provides you with the possibility to subscribe and buy confiscated goods directly. Giving factories and companies the opportunity to display their products to the largest number of traders and commercial stores looking for sources to buy goods.",
        packagesTitle: "Subscription Packages",
        monthly: "Monthly",
        threeMonths: "3 Months",
        sixMonths: "6 Months",
        yearly: "Yearly",
        auctions: "Auctions",
        confiscated: "Confiscated Goods",
        productDisplay: "Product Display",
        banksTitle: "Supported Banks",
        contactTitle: "Contact Us",
        send: "Send",
        allRights: "All rights reserved",
        namePlaceholder: "Name",
        businessDomainPlaceholder: "Your business field or industry sector",
        businessDescriptionPlaceholder: "Tell us a bit about your business and what you do",
        messagePlaceholder: "Message",
        logoAlt: "Go Business Logo",
        portViewAlt: "Port View",
        bankHapoalimAlt: "Bank Hapoalim",
        bankMarkantelAlt: "Markantel",
        bankWesternUnionAlt: "Western Union",
        bankSendingAlt: "Money Transfers",
        bankMoneygramAlt: "MoneyGram",
        bankHapoalimName: "Bank Hapoalim",
        bankMarkantelName: "Markantel",
        bankWesternUnionName: "Western Union",
        bankSendingName: "Money Transfers",
        bankMoneygramName: "MoneyGram",
        fillAllFields: "Please fill in all fields",
        messageSentSuccess: "Message sent successfully!"
    },
    ru: {
        since: "С 1993 года",
        videoNotSupported: "Ваш браузер не поддерживает HTML видео.",
        aboutTitle: "О нас",
        aboutText: "Компания Go Business, основанная в 1993 году, предлагает множество коммерческих услуг. Компания предоставляет вам возможность участвовать во всех аукционах на различные товары из порта напрямую через Zoom. Компания предоставляет вам возможность подписаться и покупать конфискованные товары напрямую. Предоставление фабрикам и компаниям возможности демонстрировать свою продукцию наибольшему количеству торговцев и коммерческих магазинов, ищущих источники для покупки товаров.",
        packagesTitle: "Пакеты подписки",
        monthly: "Ежемесячно",
        threeMonths: "3 месяца",
        sixMonths: "6 месяцев",
        yearly: "Годовой",
        auctions: "Аукционы",
        confiscated: "Конфискованные товары",
        productDisplay: "Демонстрация продукции",
        banksTitle: "Поддерживаемые банки",
        contactTitle: "Связаться с нами",
        send: "Отправить",
        allRights: "Все права защищены",
        namePlaceholder: "Имя",
        businessDomainPlaceholder: "Сфера вашего бизнеса или отрасль",
        businessDescriptionPlaceholder: "Расскажите немного о вашем бизнесе и чем вы занимаетесь",
        messagePlaceholder: "Сообщение",
        logoAlt: "Логотип Go Business",
        portViewAlt: "Вид порта",
        bankHapoalimAlt: "Банк Хапоалим",
        bankMarkantelAlt: "Маркантель",
        bankWesternUnionAlt: "Вестерн Юнион",
        bankSendingAlt: "Денежные переводы",
        bankMoneygramAlt: "Монейграм",
        bankHapoalimName: "Банк Хапоалим",
        bankMarkantelName: "Маркантель",
        bankWesternUnionName: "Вестерн Юнион",
        bankSendingName: "Денежные переводы",
        bankMoneygramName: "Монейграм",
        fillAllFields: "Пожалуйста, заполните все поля",
        messageSentSuccess: "Сообщение отправлено успешно!"
    }
};

// Current language
let currentLang = 'he';

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    initializeLanguage();
    initializeContactForm();
    initializeGallery();
    initializeVideo();
});

// Language functionality
function initializeLanguage() {
    const langButtons = document.querySelectorAll('.lang-btn');
    const mobileSelect = document.getElementById('mobile-lang-select');
    
    // Desktop language buttons
    langButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });
    
    // Mobile language dropdown
    mobileSelect.addEventListener('change', function() {
        switchLanguage(this.value);
    });
}

function switchLanguage(lang) {
    currentLang = lang;
    
    // Update active button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    
    // Update mobile select
    document.getElementById('mobile-lang-select').value = lang;
    
    // Update document direction
    if (lang === 'ar' || lang === 'he') {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', lang);
    } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', lang);
    }
    
    // Translate all elements
    translatePage(lang);
    
    // Smoothly handle gallery direction change without shaking
    handleGalleryLanguageChange();
}

function translatePage(lang) {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update alt attributes
    const altElements = document.querySelectorAll('[data-translate-alt]');
    altElements.forEach(element => {
        const key = element.getAttribute('data-translate-alt');
        if (translations[lang] && translations[lang][key]) {
            element.alt = translations[lang][key];
        }
    });
    
    // Update placeholders
    const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
    
    // Update meta tags
    updateMetaTags(lang);
}

function updateMetaTags(lang) {
    const title = document.querySelector('title');
    const description = document.querySelector('meta[name="description"]');
    const ogTitle = document.querySelector('meta[property="og:title"]');
    const ogDescription = document.querySelector('meta[property="og:description"]');
    const twitterTitle = document.querySelector('meta[property="twitter:title"]');
    const twitterDescription = document.querySelector('meta[property="twitter:description"]');
    
    if (lang === 'he') {
        title.textContent = 'Go Business - מאז 1993';
        description.content = 'Go Business - חברה שנוסדה בשנת 1993 מציעה מגוון רחב של שירותים עסקיים';
        ogTitle.content = 'Go Business - מי אנחנו';
        ogDescription.content = 'Go Business - חברה שנוסדה בשנת 1993 מציעה מגוון רחב של שירותים עסקיים';
        twitterTitle.content = 'Go Business - מי אנחנו';
        twitterDescription.content = 'Go Business - חברה שנוסדה בשנת 1993 מציעה מגוון רחב של שירותים עסקיים';
    } else if (lang === 'ar') {
        title.textContent = 'Go Business - منذ 1993';
        description.content = 'Go Business - شركة تأسست سنة 1993 تقدم خدمات تجارية متنوعة';
        ogTitle.content = 'Go Business - قصتنا';
        ogDescription.content = 'Go Business - شركة تأسست سنة 1993 تقدم خدمات تجارية متنوعة';
        twitterTitle.content = 'Go Business - قصتنا';
        twitterDescription.content = 'Go Business - شركة تأسست سنة 1993 تقدم خدمات تجارية متنوعة';
    } else if (lang === 'en') {
        title.textContent = 'Go Business - Since 1993';
        description.content = 'Go Business - Company founded in 1993 offering diverse commercial services';
        ogTitle.content = 'Go Business - About Us';
        ogDescription.content = 'Go Business - Company founded in 1993 offering diverse commercial services';
        twitterTitle.content = 'Go Business - About Us';
        twitterDescription.content = 'Go Business - Company founded in 1993 offering diverse commercial services';
    } else if (lang === 'ru') {
        title.textContent = 'Go Business - С 1993 года';
        description.content = 'Go Business - Компания, основанная в 1993 году, предлагает разнообразные коммерческие услуги';
        ogTitle.content = 'Go Business - О нас';
        ogDescription.content = 'Go Business - Компания, основанная в 1993 году, предлагает разнообразные коммерческие услуги';
        twitterTitle.content = 'Go Business - О нас';
        twitterDescription.content = 'Go Business - Компания, основанная в 1993 году, предлагает разнообразные коммерческие услуги';
    }
}

function handleGalleryLanguageChange() {
    if (window.__restartMarquee) {
        window.__restartMarquee();
    }
}


// Contact form functionality
function initializeContactForm() {
    const form = document.getElementById('contactForm');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('contactName').value;
        const businessDomain = document.getElementById('businessDomain').value;
        const businessDescription = document.getElementById('businessDescription').value;
        const message = document.getElementById('contactMessage').value;
        
        if (!name || !businessDomain || !businessDescription || !message) {
            alert(translations[currentLang].fillAllFields);
            return;
        }
        
        // Create WhatsApp message with all fields based on current language
        let whatsappMessage;
        if (currentLang === 'he') {
            whatsappMessage = `שלום, אני ${name}.\nתחום העסק: ${businessDomain}\nעל העסק: ${businessDescription}\nהודעה: ${message}`;
        } else if (currentLang === 'ar') {
            whatsappMessage = `مرحبا، أنا ${name}.\nمجال العمل: ${businessDomain}\nعن العمل: ${businessDescription}\nالرسالة: ${message}`;
        } else if (currentLang === 'en') {
            whatsappMessage = `Hello, I am ${name}.\nBusiness Domain: ${businessDomain}\nAbout Business: ${businessDescription}\nMessage: ${message}`;
        } else if (currentLang === 'ru') {
            whatsappMessage = `Привет, я ${name}.\nСфера бизнеса: ${businessDomain}\nО бизнесе: ${businessDescription}\nСообщение: ${message}`;
        }
        const encodedMessage = encodeURIComponent(whatsappMessage);
        
        // WhatsApp API URL (send to the specified number)
        const whatsappUrl = `https://wa.me/972544224615?text=${encodedMessage}`;
        
        // Open WhatsApp
        window.open(whatsappUrl, '_blank');
        
        // Reset form
        form.reset();
    });
}

// Smooth scrolling for better UX
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Header scroll effect
window.addEventListener('scroll', function() {
    const header = document.querySelector('.header');
    if (window.scrollY > 100) {
        header.style.background = 'rgba(255, 255, 255, 0.2)';
    } else {
        header.style.background = 'rgba(255, 255, 255, 0.1)';
    }
});

// Gallery functionality
function initializeGallery() {
    // Continuous marquee: duplicate items and animate translateX with RTL normalization, pausing on hover/touch
    const track = document.getElementById('galleryTrack');
    const wrapper = document.querySelector('.gallery-wrapper');
    if (!track || !wrapper) return;

    let prepared = false;
    let originalCount = 0;
    let contentWidth = 0;
    let x = 0;
    let rafId = null;
    let running = false;
    let isPaused = false;
    let lastTs = 0;

    const isRTL = () => document.documentElement.getAttribute('dir') === 'rtl';
    const speedPerMs = 0.08; // px per ms (~4.8px @60fps)

    function measure() {
        // After duplication, one set equals half of total scroll width (includes gaps)
        contentWidth = track.scrollWidth / 2;
        if (contentWidth <= 0) return;
        // Keep x in wrap range
        if (x <= -contentWidth) x += contentWidth;
        if (x >= 0) x -= contentWidth;
    }

    function prepareOnce() {
        if (prepared) return;
        const children = Array.from(track.children);
        originalCount = children.length;
        const frag = document.createDocumentFragment();
        children.forEach(node => {
            const clone = node.cloneNode(true);
            clone.setAttribute('aria-hidden', 'true');
            frag.appendChild(clone);
        });
        track.appendChild(frag);
        // Disable CSS transitions to avoid jitter; keep shadows/styles intact
        track.style.transition = 'none';
        track.style.willChange = 'transform';
        prepared = true;
        measure();
    }

    function step(ts) {
        if (!running) return;
        if (!lastTs) lastTs = ts;
        const dt = ts - lastTs;
        lastTs = ts;

        if (!isPaused && contentWidth > 0) {
            const dir = isRTL() ? 1 : -1; // RTL moves rightwards, LTR leftwards
            x += dir * speedPerMs * dt;

            if (x <= -contentWidth) x += contentWidth;
            if (x >= 0) x -= contentWidth;

            track.style.transform = `translateX(${x}px)`;
        }
        rafId = requestAnimationFrame(step);
    }

    function start() {
        if (running) return;
        prepareOnce();
        running = true;
        lastTs = 0;
        rafId = requestAnimationFrame(step);
    }

    function stop() {
        running = false;
        lastTs = 0;
        if (rafId) {
            cancelAnimationFrame(rafId);
            rafId = null;
        }
    }

    function pause() { isPaused = true; }
    function resumeDelayed() { setTimeout(() => { isPaused = false; }, 300); }

    // Expose restart for language changes/resizes
    window.__restartMarquee = () => {
        measure();
    };

    // Pause/resume on interaction
    wrapper.addEventListener('mouseenter', pause);
    wrapper.addEventListener('mouseleave', resumeDelayed);
    wrapper.addEventListener('pointerdown', pause);
    wrapper.addEventListener('pointerup', resumeDelayed, { passive: true });
    wrapper.addEventListener('touchstart', pause, { passive: true });
    wrapper.addEventListener('touchend', resumeDelayed, { passive: true });

    // Recalculate sizes on resize
    window.addEventListener('resize', () => {
        const prev = contentWidth;
        measure();
        if (prev && contentWidth) {
            x = x % contentWidth;
        }
    });

    start();
}

// Video functionality
function initializeVideo() {
    const video = document.querySelector('.main-video');
    if (!video) return;
    
    // Ensure video loads metadata on mobile
    video.addEventListener('loadedmetadata', function() {
        console.log('Video metadata loaded');
    });
    
    // Handle video loading on mobile
    video.addEventListener('loadstart', function() {
        console.log('Video loading started');
    });
    
    // Ensure poster is visible on mobile
    if (window.innerWidth <= 768) {
        video.load();
    }
}

// Initialize with Hebrew as default
switchLanguage('he');

